"use strict";var _createClass=function(){function e(f,g){for(var j,h=0;h<g.length;h++)j=g[h],j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(f,j.key,j)}return function(f,g,h){return g&&e(f.prototype,g),h&&e(f,h),f}}();function _classCallCheck(e,f){if(!(e instanceof f))throw new TypeError("Cannot call a class as a function")}var JSSalsa20=function(){function e(f,g){if(_classCallCheck(this,e),!(f instanceof Uint8Array)||32!==f.length)throw new Error("Key should be 32 byte array!");if(!(g instanceof Uint8Array)||8!==g.length)throw new Error("Nonce should be 8 byte array!");this.rounds=20,this.sigma=[1634760805,857760878,2036477234,1797285236],this.param=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.param[0]=this.sigma[0],this.param[5]=this.sigma[1],this.param[10]=this.sigma[2],this.param[15]=this.sigma[3],this.param[1]=this._get32(f,0),this.param[2]=this._get32(f,4),this.param[3]=this._get32(f,8),this.param[4]=this._get32(f,12),this.param[6]=this._get32(g,0),this.param[7]=this._get32(g,4),this.param[8]=0,this.param[9]=0,this.param[11]=this._get32(f,16),this.param[12]=this._get32(f,20),this.param[13]=this._get32(f,24),this.param[14]=this._get32(f,28),this.block=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.byteCounter=0}return _createClass(e,[{key:"_update",value:function _update(f){if(!(f instanceof Uint8Array)||0===f.length)throw new Error("Data should be type of bytes (Uint8Array) and not empty!");for(var g=new Uint8Array(f.length),h=0;h<f.length;h++)(0===this.byteCounter||64===this.byteCounter)&&(this._salsa(),this._counterIncrement(),this.byteCounter=0),g[h]=f[h]^this.block[this.byteCounter++];return g}},{key:"encrypt",value:function encrypt(f){return this._update(f)}},{key:"decrypt",value:function decrypt(f){return this._update(f)}},{key:"_counterIncrement",value:function _counterIncrement(){this.param[8]=this.param[8]+1>>>0,0==this.param[8]&&(this.param[9]=this.param[9]+1>>>0)}},{key:"_salsa",value:function _salsa(){var f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=0,h=0;for(g=0;16>g;g++)f[g]=this.param[g];for(g=0;g<this.rounds;g+=2)this._quarter(f,4,8,12,0),this._quarter(f,9,13,1,5),this._quarter(f,14,2,6,10),this._quarter(f,3,7,11,15),this._quarter(f,1,2,3,0),this._quarter(f,6,7,4,5),this._quarter(f,11,8,9,10),this._quarter(f,12,13,14,15);for(g=0;16>g;g++)f[g]+=this.param[g],this.block[h++]=255&f[g],this.block[h++]=255&f[g]>>>8,this.block[h++]=255&f[g]>>>16,this.block[h++]=255&f[g]>>>24}},{key:"_quarter",value:function _quarter(f,g,h,j,k){f[g]=(f[g]^this._rotl(f[k]+f[j],7))>>>0,f[h]=(f[h]^this._rotl(f[g]+f[k],9))>>>0,f[j]=(f[j]^this._rotl(f[h]+f[g],13))>>>0,f[k]=(f[k]^this._rotl(f[j]+f[h],18))>>>0}},{key:"_get32",value:function _get32(f,g){return f[g++]^f[g++]<<8^f[g++]<<16^f[g]<<24}},{key:"_rotl",value:function _rotl(f,g){return f<<g|f>>>32-g}}]),e}();"undefined"!=typeof module&&module.exports&&(module.exports=JSSalsa20);
